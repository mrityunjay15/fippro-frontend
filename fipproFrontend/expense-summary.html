<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Expense Summary - FIPPRO</title>
    <link rel="stylesheet" href="assets/global.css">
</head>
<body>

<!-- Sidebar -->
<div class="sidebar">
    <div class="brand">
        <div class="logo">F</div>
        <span style="font-weight:700; font-size:18px;">FIPPRO</span>
    </div>
    <nav>
        <a class="nav-item" href="dashboard.html"><i>üè†</i> Dashboard</a>
        <a class="nav-item active" href="expense-summary.html"><i>üí∏</i> Expenses</a>
        <a class="nav-item" href="income-summary.html"><i>üí∞</i> Income</a>
        <a class="nav-item" href="product-summary.html"><i>üì¶</i> Products</a>
    </nav>
</div>

<!-- Topbar -->
<div class="topbar">
    <h2>Expense Summary</h2>
</div>

<!-- Main Content -->
<div class="container fade-up">

    <div class="card">
        <h2>Total Expenses: <span id="totalExpenses">0</span> ‚Çπ</h2>
    </div>

    <div class="card mt-8">
        <h2>All Expenses</h2>
        <table class="table mt-8">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Title</th>
                    <th>Amount</th>
                    <th>Category</th>
                    <th>Date</th>
                    <th>Description</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="expenseTableBody">
                <!-- Expenses will be loaded here -->
            </tbody>
        </table>
    </div>
</div>

<script>
    const userId = localStorage.getItem("userId"); // Make sure user is logged in
    const API_URL = `http://localhost:8080/api/expenses/user/${userId}`;

    async function loadExpenses() {
        const response = await fetch(API_URL);
        const expenses = await response.json();

        let total = 0;
        const tbody = document.getElementById('expenseTableBody');
        tbody.innerHTML = '';

        expenses.forEach(exp => {
            total += exp.amount;
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${exp.id}</td>
                <td>${exp.title || '-'}</td>
                <td>${exp.amount}</td>
                <td>${exp.category || '-'}</td>
                <td>${exp.date || '-'}</td>
                <td>${exp.description || '-'}</td>
                <td><button class="btn" onclick="deleteExpense(${exp.id})">Delete</button></td>
            `;
            tbody.appendChild(tr);
        });

        document.getElementById('totalExpenses').innerText = total.toFixed(2);
    }

    async function deleteExpense(id) {
        if(!confirm("Are you sure you want to delete this expense?")) return;
        await fetch(`http://localhost:8080/api/expenses/${id}`, { method: 'DELETE' });
        loadExpenses();
    }

    loadExpenses();
</script>
</body>
</html>
